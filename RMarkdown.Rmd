---
title: "R Markdown workshop"
output: 
  html_document:
    toc: true
    theme: spacelab
    highlight: haddock
---

``` {r setup, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
source('R/common.R')
```

# What is R Markdown?

R + Markdown

# How can you use R Markdown?

## Document your code

Use R Markdown to make your code pretty and share it with others.  R code in the .Rmd function exactly the same as in a regular .R script.  A reader can see your code, and what it does.

- Explain your code or teach it to others
- Show all code with outputs
- Basically: human-readable coding

#### Example: some basic code.

Question: What is the solar irradiance at the orbital distance of Mars? How about for the other planets?

Set variables for solar irradiance at Earth's orbital radius, in W * m-2

```{r document code 1, echo = TRUE, eval = TRUE}
insol_earth <- 1360 
```

Read planet orbital radii from .csv, and drop Pluto, because really.  Then calc insolation at each planet using inverse square law.

```{r document code 2, echo = TRUE, eval = TRUE}
planet_df <- read.csv('data/planets.csv')

r_earth <- planet_df$radius[3]

planet_df <- planet_df %>%
  filter(planet != 'Pluto') %>%
  mutate(au = radius/r_earth,
         insol = insol_earth/(au^2))
```

Print table and plot results

```{r document code 3, echo = TRUE, eval = TRUE}
print(planet_df)

cat(sprintf('Insolation on Mars is %.3f W * m^-2, about %.1f%% that on Earth.\n',
            planet_df$insol[4], planet_df$insol[4]/insol_earth*100))

insol_plot <- ggplot(data = planet_df, aes(x = radius, y = insol, color = planet)) +
  ### set text style, title size and position, and legend position:
  theme(text = element_text(family = 'Helvetica', color = 'gray30', size = 12),
        plot.title = element_text(size = rel(1.5), hjust = 0, face = 'bold'),
        legend.position = 'right') +
  scale_x_log10() + scale_y_log10() + 
  geom_point(size = 3) + 
  labs(title = 'Insolation on other planets',
       x = 'radius (x 10^6 km) (log scale)',
       y = 'insolation (W * m^-2) (log scale)')
  
print(insol_plot)
```

## Document your workflow

Use R Markdown to highlight the workflow of your code, to share your process.  The code itself is not so important; instead, you can focus on the steps you used to get from input A to output B.

- Reproducibility and provenance
- Focus on the process: inputs, outputs, and the steps in between
- Specific code is not emphasized except where critical

#### Example: again, almost the exact same code as above

*(Note the code chunk options: echo = FALSE, to hide code, but `cat()` or `print()` will be displayed)*

Question: What is the solar irradiance at the orbital distance of Mars? How about for the other planets?

Solar irradiance at Earth's orbital radius = 1360 W * m^-2^ [[Wikipedia, 2015](https://en.wikipedia.org/wiki/Solar_irradiance#Earth)]

```{r document workflow 1, echo = FALSE, eval = TRUE}
insol_earth <- 1366 
```

Read planet orbital radii from .csv, and drop Pluto, because really.  Then calc insolation at each planet using inverse square law.

```{r document workflow 2, echo = FALSE, eval = TRUE}
cat('Reading orbits data from file: data/planets.csv\n')
planet_df <- read.csv('data/planets.csv')
git_prov('data/planets.csv')

r_earth <- planet_df$radius[3]

planet_df <- planet_df %>%
  filter(planet != 'Pluto') %>%
  mutate(au = radius/r_earth,
         insol = insol_earth/(au^2))

print(planet_df)
```

According to the analysis, insolation on Mars is `r round(planet_df$insol[4], 3)` W m^2^, about `r round(planet_df$insol[4]/insol_earth*100)`% that on Earth.

```{r document workflow 3, echo = FALSE, eval = FALSE}
insol_plot <- ggplot(data = planet_df, aes(x = radius, y = insol, color = planet)) +
  ### set text style, title size and position, and legend position:
  theme(text = element_text(family = 'Helvetica', color = 'gray30', size = 12),
        plot.title = element_text(size = rel(1.5), hjust = 0, face = 'bold'),
        legend.position = 'right') +
  scale_x_log10() + scale_y_log10() + 
  geom_point(size = 3) + 
  labs(title = 'Insolation on other planets',
       x = 'radius (x 10^6 km) (log scale)',
       y = 'insolation (W * m^-2) (log scale)')
  
print(insol_plot)
```


## Document your results

Use R Markdown to document your results.  The code itself is not important; even the intermediate steps are not all that interesting.  Instead, you can focus on your research question and present the results in nicely-formatted tables and graphs.

- Hide the work: if they want to see the process, they can dig into the document.
- Focus on the big picture: formatted writeup and fancy graphs
- Probably doesn't even look like code

#### Example: almost the exact same code as above

*(Code chunks all echo = FALSE, and most of the results reported in inline R code rather than printing from within the code chunks)*

Question: What is the solar irradiance at the orbital distance of Mars? How about for the other planets?

Solar irradiance at Earth's orbital radius = 1360 W * m^-2^ [[Wikipedia, 2015](https://en.wikipedia.org/wiki/Solar_irradiance#Earth)].

```{r document results 1, echo = FALSE, eval = TRUE}
insol_earth <- 1366 
```

Insolation can be determined from the inverse-square law, using the equation:

$$ S_r = S_{Earth} * \left(\frac{r_{Earth}}{r_x}\right) ^2 $$

```{r document results 2, echo = FALSE, eval = TRUE}
planet_df <- read.csv('data/planets.csv')

r_earth <- planet_df$radius[3]

planet_df <- planet_df %>%
  filter(planet != 'Pluto') %>%
  mutate(au = radius/r_earth,
         insol = insol_earth/(au^2))
```

According to the analysis, insolation on Mars, at `r round(planet_df$au[4], 2)` times the Earth's orbital radius, is `r round(planet_df$insol[4], 3)` W m^2^, about `r round(planet_df$insol[4]/insol_earth*100)`% that on Earth.  For other planets, examine figure 1.

```{r document results 3, echo = FALSE, eval = TRUE}
insol_plot <- ggplot(data = planet_df, aes(x = radius, y = insol, color = planet)) +
  ### set text style, title size and position, and legend position:
  theme(text = element_text(family = 'Helvetica', color = 'gray30', size = 12),
        plot.title = element_text(size = rel(1.5), hjust = 0, face = 'bold'),
        legend.position = 'right') +
  scale_x_log10() + scale_y_log10() + 
  geom_point(size = 3) + 
  labs(title = 'Figure 1: Insolation on other planets',
       x = 'radius (x 10^6 km) (log scale)',
       y = 'insolation (W * m^-2) (log scale)')
  
print(insol_plot)
```


## Markdown style basics (outside of code chunks):

[Here's a great R Markdown reference sheet](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf), including basic Markdown formatting.  No need to recreate all the different formatting options here; but you should get to know and love the following, which are all easy:

* bulleted lists
    * including multi-level bullets and numbered lists  
* *italics*, **bold**, and even ***bold italics***
* headers - six levels, from # (HUGE) to ###### (small)
* `inline monospaced text` including inline executable R code
* code blocks, non-executing (just display) and executing (R code chunks)

[Print out this awesome reference sheet](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) and nail it to your monitor.

Markdown is finicky, but R Markdown is especially finicky about line breaks and spaces.  A single line break is treated about the same as a space.  Between sections with different formatting, it's good to always put a blank line (two line breaks).  If the format looks wrong, you probably forgot to space it properly.

## Document setup: the Rmd header

The top of the .Rmd file needs a header.  At very least, the dashes, a title, and output format.  Note that the left alignment and tab spacing are important.

```
---
title: "R Markdown workshop"
output: html_document
---
```
more options can go in the header; more on these later:
```
---
title: "R Markdown workshop"
output: 
  html_document:
    toc: true
    theme: spacelab
    highlight: haddock
  pdf_document:
    toc: true
    theme: spacelab
    highlight: haddock
---
```


  
  Chunks:
  - headers in chunks
  - echo
  - message
  - warning
  - others...
  
  Common Issues:
    - never setwd()
  - preview/rawgit (awesome but only for public repos)
  - ggplot2 needs to use print()
  - spaces/line breaks
  
  Advanced?:
  - tables
  - Themes
  - Set Knit Options
  - Knitchild??? (knitting multiple Rmd together)
  
  
  For the actual script I think we need at least:
    
    - 1 image
  - a couple plots
  - 4-6 code chunks?
  